{% extends "base.html" %}
{% load static %}

{% block body_attrs %}data-filter-sensitive="true"{% endblock %}

{% block title %}{{ theme.name }} - {{ comparison_set.name }}{% endblock %}
{% block meta_description %}Compare what the Westminster Confession, Shorter Catechism, and Larger Catechism teach about {{ theme.name }}.{% endblock %}
{% block og_title %}{{ theme.name }} - Compare the Reformed Standards{% endblock %}
{% block og_description %}See how the Westminster Confession, Shorter Catechism, and Larger Catechism treat {{ theme.name }}.{% endblock %}

{% block content %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'catechism:home' %}">Home</a></li>
        <li class="breadcrumb-item"><a href="{% url 'catechism:compare_index' %}">Compare</a></li>
        <li class="breadcrumb-item"><a href="{% url 'catechism:compare_set' set_slug=comparison_set.slug %}">{{ comparison_set.name }}</a></li>
        <li class="breadcrumb-item active">{{ theme.name }}</li>
    </ol>
</nav>

<!-- Prev/Next theme navigation -->
<div class="d-flex justify-content-between mb-3">
    {% if previous_theme %}
    <a href="{{ previous_theme.get_absolute_url }}" class="btn btn-outline-secondary btn-sm">
        <i class="bi bi-chevron-left me-1"></i>{{ previous_theme.name|truncatewords:5 }}
    </a>
    {% else %}<span></span>{% endif %}
    {% if next_theme %}
    <a href="{{ next_theme.get_absolute_url }}" class="btn btn-outline-secondary btn-sm">
        {{ next_theme.name|truncatewords:5 }}<i class="bi bi-chevron-right ms-1"></i>
    </a>
    {% else %}<span></span>{% endif %}
</div>

<h1 class="mb-2">{{ theme.name }}</h1>
{% if theme.description %}
<p class="text-muted mb-4">{{ theme.description }}</p>
{% endif %}

{# Column visibility toggles #}
{% if columns|length > 2 %}
<div class="mb-3">
    <span class="text-muted small me-2">Show/hide:</span>
    {% for col in columns %}
    <div class="form-check form-check-inline">
        <input class="form-check-input col-toggle" type="checkbox" checked
               value="{{ col.catechism.slug }}" id="toggle-{{ col.catechism.slug }}">
        <label class="form-check-label small" for="toggle-{{ col.catechism.slug }}">
            {{ col.catechism.name }}
        </label>
    </div>
    {% endfor %}
</div>
{% endif %}

{% with col_count=columns|length %}
<div class="row" id="comparison-columns">
    {% for col in columns %}
    <div class="{% if col_count == 1 %}col-lg-12{% elif col_count == 2 %}col-lg-6{% elif col_count == 3 %}col-lg-4{% else %}col-lg-3{% endif %} mb-4 comparison-col ps-4"
         style="border-left: 2px solid color-mix(in srgb, var(--wm-primary) 25%, transparent);"
         data-doc="{{ col.catechism.slug }}">
        <div class="flat-section-heading mb-3">
            {{ col.catechism.abbreviation }}
            <span class="text-muted fw-normal ms-1" style="font-size: 0.75rem; text-transform: none; letter-spacing: 0;">
                {{ col.catechism.item_prefix }}{{ col.display_start }}{% if col.question_start != col.question_end %}&ndash;{{ col.display_end }}{% endif %}
            </span>
        </div>
        {% for q in col.questions %}
        <a href="{{ q.get_absolute_url }}"
           class="d-block py-3 text-decoration-none border-bottom"
           style="border-color: var(--wm-border) !important; color: var(--bs-body-color);">
            {% if col.catechism.is_prose_document %}
            <p class="mb-1 small fw-semibold">{{ q.question_text }}</p>
            <p class="mb-0 text-muted small">{{ q.answer_text }}</p>
            {% else %}
            <p class="mb-1 small fw-semibold"><strong>Q{{ q.number }}.</strong> {{ q.question_text }}</p>
            <p class="mb-0 text-muted small"><strong>A.</strong> {{ q.answer_text }}</p>
            {% endif %}
        </a>
        {% empty %}
        <p class="text-muted small">No entries.</p>
        {% endfor %}
    </div>
    {% empty %}
    <p class="text-muted">No entries for this theme.</p>
    {% endfor %}
</div>
{% endwith %}

<!-- Prev/Next (bottom) -->
<div class="d-flex justify-content-between mt-3 mb-4">
    {% if previous_theme %}
    <a href="{{ previous_theme.get_absolute_url }}" class="btn btn-outline-secondary">
        <i class="bi bi-chevron-left me-1"></i>{{ previous_theme.name|truncatewords:5 }}
    </a>
    {% else %}<span></span>{% endif %}
    {% if next_theme %}
    <a href="{{ next_theme.get_absolute_url }}" class="btn btn-outline-secondary">
        {{ next_theme.name|truncatewords:5 }}<i class="bi bi-chevron-right ms-1"></i>
    </a>
    {% else %}<span></span>{% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/compare.js' %}"></script>
{% endblock %}
